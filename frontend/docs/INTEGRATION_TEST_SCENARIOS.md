# 통합 테스트 시나리오 문서

## 개요

이 문서는 Kiko 프로젝트의 **라디오/스크립트 플레이어-백엔드 통합** (T-007) 작업에 대한 포괄적인 테스트 시나리오를 정의합니다.

## 테스트 환경

### 필수 구성 요소

- **프론트엔드**: SvelteKit 개발 서버 (http://localhost:5173 또는 5174)
- **백엔드**: FastAPI 서버 (http://localhost:8000)
- **데이터베이스**: Supabase PostgreSQL (개발 환경)
- **WebSocket**: 실시간 동기화 서비스

### 테스트 페이지

- **통합 테스트 UI**: `/test/integration`
- **Mock API 모드**: 백엔드 없이 가상 데이터로 테스트
- **Real API 모드**: 실제 백엔드와 연동 테스트

## 테스트 시나리오

### 1. Mock API 모드 테스트

#### 1.1 기본 API 기능 테스트

**목적**: Mock API 서버를 통한 기본 API 호출 검증

**수행 단계**:

1. 통합 테스트 페이지 접속
2. "Mock API 모드" 토글 활성화
3. "기본 API 테스트" 버튼 클릭
4. 각 API 테스트 결과 확인:
   - Scripts API: ✅ 스크립트 목록 및 카테고리 조회
   - Audio API: ✅ 스트림 정보 및 준비 상태 확인
   - Sync API: ✅ 매핑 정보 및 헬스 체크
   - WebSocket: ✅ 연결 상태 확인

**예상 결과**:

- 모든 API 테스트 통과 (4/4)
- 응답 시간 < 1초
- 에러 없음

#### 1.2 스크립트 로드 통합 테스트

**목적**: Mock 데이터로 전체 스크립트 로드 플로우 검증

**수행 단계**:

1. 스크립트 ID: `demo-news-001` (기본값)
2. "스크립트 로드" 버튼 클릭
3. 로딩 과정 모니터링:
   - 통합 서비스 초기화
   - API 호출 시퀀스
   - 스토어 상태 업데이트
   - UI 렌더링

**예상 결과**:

- 스크립트 로드 성공
- 실시간 상태 모니터링에서 모든 상태 ✅
- 통합 플레이어 UI 표시
- 로그에 성공 메시지 표시

#### 1.3 포괄적 테스트

**목적**: 성능, 에러 처리 등 전체적인 시스템 검증

**수행 단계**:

1. "포괄적 테스트" 버튼 클릭
2. 다음 테스트 자동 실행:
   - 기본 API 테스트
   - 스크립트 로드 테스트
   - 성능 테스트 (응답 시간 측정)
   - 에러 처리 테스트 (잘못된 요청)

**예상 결과**:

- 모든 기본 테스트 통과
- Performance 테스트: 모든 API < 1000ms
- Error Handling 테스트: 적절한 에러 처리 확인

### 2. Real API 모드 테스트

#### 2.1 백엔드 연결 확인

**목적**: 실제 백엔드 서버와의 연결 검증

**전제 조건**:

- 백엔드 서버 실행 중 (http://localhost:8000)
- 데이터베이스 연결 정상
- 테스트 데이터 준비

**수행 단계**:

1. Mock API 모드 비활성화
2. "기본 API 테스트" 실행
3. 각 엔드포인트 응답 확인

**예상 결과**:

- Scripts API: 실제 스크립트 데이터 또는 빈 배열
- Audio API: 실제 스트림 정보 또는 404 에러
- Sync API: 헬스 체크 성공
- WebSocket: 연결 시도 (성공/실패 모두 허용)

#### 2.2 실제 데이터 통합 테스트

**목적**: 실제 스크립트 데이터로 전체 플로우 검증

**수행 단계**:

1. 실제 존재하는 스크립트 ID 입력 (있다면)
2. 또는 기본 테스트 스크립트 ID 사용
3. "스크립트 로드" 실행
4. 응답에 따른 결과 확인

**예상 결과**:

- 성공 시: 실제 데이터로 플레이어 로드
- 실패 시: 적절한 에러 메시지 표시

### 3. 성능 및 안정성 테스트

#### 3.1 응답 시간 테스트

**목적**: API 응답 시간이 요구사항을 만족하는지 검증

**기준**:

- p95 API 응답 시간 < 300ms (목표)
- 최대 허용 응답 시간 < 1000ms

**측정 항목**:

- Scripts API 응답 시간
- Audio API 응답 시간
- Sync API 응답 시간

#### 3.2 에러 복구 테스트

**목적**: 네트워크 오류, 서버 오류 시 적절한 처리 검증

**테스트 케이스**:

- 존재하지 않는 스크립트 ID 요청
- 네트워크 타임아웃 시뮬레이션
- 서버 5xx 에러 응답

### 4. 사용자 경험 테스트

#### 4.1 UI/UX 확인

**목적**: 사용자 인터페이스의 직관성과 반응성 검증

**체크 항목**:

- [ ] 로딩 상태 표시 적절함
- [ ] 에러 메시지 명확함
- [ ] 성공/실패 상태 구분 명확함
- [ ] 실시간 상태 업데이트 정상
- [ ] 버튼 비활성화/활성화 적절함

#### 4.2 접근성 확인

**목적**: WCAG 2.1 AA 준수 여부 검증

**체크 항목**:

- [ ] 키보드 네비게이션 가능
- [ ] 색상 대비 충분
- [ ] 스크린 리더 지원
- [ ] 포커스 표시 명확

## 통합 검증 체크리스트

### Phase 1: Mock API 기본 기능 ✅

- [ ] Mock API 모드 전환 정상 동작
- [ ] 4개 기본 API 테스트 모두 통과
- [ ] 스크립트 로드 성공
- [ ] 실시간 로그 표시 정상
- [ ] 상태 모니터링 정상 업데이트

### Phase 2: Real API 연동 🔄

- [ ] 백엔드 서버 연결 성공
- [ ] 실제 API 엔드포인트 응답 확인
- [ ] WebSocket 연결 시도 확인
- [ ] 에러 처리 정상 동작

### Phase 3: 성능 및 안정성 ⏱️

- [ ] API 응답 시간 기준 충족
- [ ] 에러 복구 메커니즘 정상
- [ ] 재시도 로직 동작 확인
- [ ] 메모리 누수 없음

### Phase 4: 문서화 및 리포트 📋

- [ ] 테스트 리포트 다운로드 기능
- [ ] 상세 로그 기록
- [ ] 성능 메트릭 포함
- [ ] 환경 정보 기록

## 테스트 완료 기준

### 필수 요구사항 (MUST)

1. **Mock API 모드**: 모든 기본 기능 정상 동작
2. **통합 플로우**: 스크립트 로드부터 UI 렌더링까지 완전 동작
3. **에러 처리**: 예외 상황에서 적절한 에러 메시지 표시
4. **성능**: API 응답 시간 < 1초

### 권장 요구사항 (SHOULD)

1. **Real API 연동**: 백엔드와의 실제 연동 성공
2. **WebSocket**: 실시간 동기화 연결 성공
3. **성능 최적화**: p95 응답 시간 < 300ms
4. **UX**: 직관적이고 반응성 좋은 사용자 인터페이스

### 선택 요구사항 (COULD)

1. **고급 테스트**: 부하 테스트, 동시성 테스트
2. **브라우저 호환성**: 다양한 브라우저에서 테스트
3. **모바일 대응**: 모바일 환경에서의 동작 확인

## 알려진 이슈 및 제한사항

### Mock API 모드

- WebSocket 연결은 실제로 수행되지 않고 로그만 출력
- 실제 오디오 재생은 테스트하지 않음 (Mock URL 사용)

### Real API 모드

- 백엔드 서버가 실행되지 않은 경우 모든 테스트 실패
- 테스트 데이터가 준비되지 않은 경우 일부 기능 제한

### 브라우저 제한사항

- CORS 정책으로 인한 일부 API 호출 제한 가능
- 로컬 개발 환경에서만 테스트 가능

## 다음 단계

1. **T-007-003 완료**: 통합 테스트 검증 및 문서화
2. **T-008 준비**: 다음 작업 단계 계획
3. **배포 준비**: 스테이징 환경 통합 테스트
4. **성능 최적화**: 병목 지점 식별 및 개선

---

**작성일**: 2024-12-24  
**버전**: 1.0  
**작성자**: AI Assistant  
**검토자**: TBD
